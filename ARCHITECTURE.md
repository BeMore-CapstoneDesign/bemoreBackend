# BeMore Backend Architecture - Ultrathink Engineering

## π§  **Ultrathink Engineering μ² ν•™ μ μ©**

### **μ„¤κ³„ μ›μΉ™**
1. **μ²« μ›λ¦¬ μ‚¬κ³ **: "μ™ μ΄ λ°©μ‹μΈκ°€?"λ¥Ό λ°λ³µ μ§λ¬Έν•λ©° κ·Όλ³Έμ  μ¬κµ¬μ„±
2. **3κ°€μ§€ λ€μ• λΉ„κµ**: λ¨λ“  κµ¬μ΅°λ” μµμ† 3κ°€μ§€ μ„¤κ³„ λ€μ•μ„ λΉ„κµ λ¶„μ„
3. **AI cognitive expansion**: κΉμ€ μ„¤κ³„ κ²€μ¦κ³Ό μ¶©λ μ‹¤ν—μ„ ν†µν• μµμ ν™”
4. **μ‹¬μΈµμ  μ•„ν‚¤ν…μ²**: λ‹¨μ κµ¬ν„μ΄ μ•„λ‹ ν™•μ¥ κ°€λ¥ν• κµ¬μ΅° μ§€ν–¥

---

## π—οΈ **μ•„ν‚¤ν…μ² κ°μ”**

### **μ„ νƒλ μ•„ν‚¤ν…μ²: Domain-Driven Design (DDD) + Clean Architecture**

**μ„ νƒ μ΄μ :**
- **κ°μ • λ¶„μ„ λ„λ©”μΈμ λ³µμ΅μ„±**: VAD, CBT, AI μƒλ‹΄ λ“± λ³µμ΅ν• λΉ„μ¦λ‹μ¤ λ΅μ§
- **ν™•μ¥μ„± μ”κµ¬μ‚¬ν•­**: μƒλ΅μ΄ AI λ¨λΈ, λ¶„μ„ λ°©μ‹ μ¶”κ°€ μ©μ΄
- **ν…μ¤νΈ μ£Όλ„ κ°λ°**: λ„λ©”μΈ λ΅μ§κ³Ό μΈν”„λΌ λ¶„λ¦¬λ΅ ν…μ¤νΈ μ©μ΄
- **λ―Έλ λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ „ν™**: μ„λΉ„μ¤ λ¶„λ¦¬ μ‹ λ…λ¦½μ  λ°°ν¬ κ°€λ¥

---

## π“ **λ μ΄μ–΄ κµ¬μ΅°**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    Presentation Layer                       β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β”‚  β”‚   User      β”‚ β”‚  Emotion    β”‚ β”‚    Chat     β”‚           β”‚
β”‚  β”‚ Controller  β”‚ β”‚ Controller  β”‚ β”‚ Controller  β”‚           β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    Application Layer                        β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β”‚  β”‚   User      β”‚ β”‚  Emotion    β”‚ β”‚    Chat     β”‚           β”‚
β”‚  β”‚   Service   β”‚ β”‚   Service   β”‚ β”‚   Service   β”‚           β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                     Domain Layer                            β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β”‚  β”‚   User      β”‚ β”‚  Emotion    β”‚ β”‚    Chat     β”‚           β”‚
β”‚  β”‚   Domain    β”‚ β”‚   Domain    β”‚ β”‚   Domain    β”‚           β”‚
β”‚  β”‚   Service   β”‚ β”‚   Service   β”‚ β”‚   Service   β”‚           β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  Infrastructure Layer                       β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β”‚  β”‚   Prisma    β”‚ β”‚   External  β”‚ β”‚   File      β”‚           β”‚
β”‚  β”‚ Repository  β”‚ β”‚    APIs     β”‚ β”‚   Storage   β”‚           β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π”„ **μμ΅΄μ„± λ°©ν–¥**

### **Dependency Inversion Principle μ μ©**
- **κ³ μμ¤€ λ¨λ“** (Domain, Application)μ€ **μ €μμ¤€ λ¨λ“** (Infrastructure)μ— μμ΅΄ν•μ§€ μ•μ
- **μΈν„°νμ΄μ¤**λ¥Ό ν†µν• μμ΅΄μ„± μ—­μ „
- **μμ΅΄μ„± μ£Όμ…**μ„ ν†µν• λ°νƒ€μ„ κ²°ν•©

```typescript
// μΈν„°νμ΄μ¤ μ •μ
interface IUserRepository {
  create(data: CreateUserData): Promise<User>;
  findByEmail(email: string): Promise<User | null>;
}

// κµ¬ν„μ²΄
class PrismaUserRepository implements IUserRepository {
  // Prisma κµ¬ν„
}

// λ„λ©”μΈ μ„λΉ„μ¤
class UserDomainService {
  constructor(private userRepository: IUserRepository) {}
}
```

---

## π“¦ **λ¨λ“ κµ¬μ΅°**

### **1. Common Module**
```
src/common/
β”β”€β”€ dto/                    # Data Transfer Objects
β”β”€β”€ guards/                 # Authentication Guards
β”β”€β”€ strategies/             # JWT Strategy
β”β”€β”€ services/               # Shared Services (Prisma)
β”β”€β”€ interfaces/             # Repository & Service Interfaces
β””β”€β”€ constants/              # Provider Tokens
```

### **2. Domain Module**
```
src/domain/
β””β”€β”€ services/               # Domain Business Logic
    β”β”€β”€ user-domain.service.ts
    β”β”€β”€ emotion-analysis-domain.service.ts
    β”β”€β”€ chat-domain.service.ts
    β””β”€β”€ history-domain.service.ts
```

### **3. Infrastructure Module**
```
src/infrastructure/
β””β”€β”€ repositories/           # Data Access Layer
    β”β”€β”€ prisma-user.repository.ts
    β”β”€β”€ prisma-emotion-analysis.repository.ts
    β””β”€β”€ prisma-chat.repository.ts
```

### **4. Feature Modules**
```
src/
β”β”€β”€ user/                   # User Management
β”β”€β”€ emotion/                # Emotion Analysis
β”β”€β”€ chat/                   # AI Chat
β””β”€β”€ history/                # Session History
```

---

## π”§ **ν•µμ‹¬ μ»΄ν¬λ„νΈ**

### **Repository Pattern**
- **μΈν„°νμ΄μ¤**: `IUserRepository`, `IEmotionAnalysisRepository`, `IChatRepository`
- **κµ¬ν„μ²΄**: `PrismaUserRepository`, `PrismaEmotionAnalysisRepository`, `PrismaChatRepository`
- **λ©μ **: λ°μ΄ν„° μ ‘κ·Ό λ΅μ§ μΊ΅μν™”, ν…μ¤νΈ μ©μ΄μ„±

### **Domain Services**
- **UserDomainService**: μ‚¬μ©μ μƒμ„±, μΈμ¦, ν”„λ΅ν•„ κ΄€λ¦¬
- **EmotionAnalysisDomainService**: κ°μ • λ¶„μ„, CBT ν”Όλ“λ°± μƒμ„±
- **ChatDomainService**: Gemini AI λ€ν™”, λ©”μ‹μ§€ κ΄€λ¦¬
- **HistoryDomainService**: μ„Έμ… μ €μ¥, νμ¤ν† λ¦¬ μ΅°ν

### **External Service Integration**
- **Python Analysis Server**: TensorFlow, Whisper κΈ°λ° κ°μ • λ¶„μ„
- **Google Gemini API**: AI λ€ν™” μ„λΉ„μ¤
- **File Storage**: μ΄λ―Έμ§€, μ¤λ””μ¤, PDF μ €μ¥

---

## π§ **ν…μ¤νΈ μ „λµ**

### **ν…μ¤νΈ ν”ΌλΌλ―Έλ“**
```
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚   E2E       β”‚  (10%)
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚   Integration      β”‚  (20%)
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         Unit               β”‚  (70%)
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### **ν…μ¤νΈ κµ¬μ΅°**
```
test/
β”β”€β”€ unit/                     # λ„λ©”μΈ λ΅μ§ λ‹¨μ„ ν…μ¤νΈ
β”β”€β”€ integration/              # Repository ν†µν•© ν…μ¤νΈ
β””β”€β”€ e2e/                      # API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
```

---

## π€ **ν™•μ¥μ„± κ³ λ ¤μ‚¬ν•­**

### **λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ „ν™ μ¤€λΉ„**
- **μ„λΉ„μ¤ κ²½κ³„**: User, Emotion, Chat, History λ…λ¦½μ  λ¶„λ¦¬ κ°€λ¥
- **API Gateway**: ν†µν•© μ—”λ“ν¬μΈνΈ κ΄€λ¦¬
- **Event-Driven**: μ„λΉ„μ¤ κ°„ λΉ„λ™κΈ° ν†µμ‹ 

### **μ„±λ¥ μµμ ν™”**
- **Caching**: Redis κΈ°λ° μ„Έμ…, λ¶„μ„ κ²°κ³Ό μΊμ‹±
- **Database**: μ½κΈ°/μ“°κΈ° λ¶„λ¦¬, μΈλ±μ¤ μµμ ν™”
- **Async Processing**: λ€μ©λ‰ νμΌ μ²λ¦¬, PDF μƒμ„±

---

## π”’ **λ³΄μ• μ•„ν‚¤ν…μ²**

### **μΈμ¦ & μΈκ°€**
- **JWT**: Stateless μΈμ¦, ν† ν° κΈ°λ° κ¶ν• κ΄€λ¦¬
- **Rate Limiting**: API νΈμ¶ μ ν•
- **Input Validation**: DTO κΈ°λ° μ…λ ¥ κ²€μ¦

### **λ°μ΄ν„° λ³΄νΈ**
- **Encryption**: λ―Όκ° λ°μ΄ν„° μ•”νΈν™”
- **GDPR Compliance**: κ°μΈμ •λ³΄ λ³΄νΈλ²• μ¤€μ
- **Audit Logging**: μ‚¬μ©μ ν™λ™ μ¶”μ 

---

## π“ **λ¨λ‹ν„°λ§ & λ΅κΉ…**

### **Observability**
- **Structured Logging**: JSON ν•νƒ λ΅κ·Έ
- **Metrics**: μ„±λ¥ μ§€ν‘ μμ§‘
- **Tracing**: λ¶„μ‚° μ¶”μ  (OpenTelemetry)

### **Health Checks**
- **Database**: μ—°κ²° μƒνƒ ν™•μΈ
- **External APIs**: Gemini, Python μ„λ²„ μƒνƒ
- **File Storage**: μ €μ¥μ† μ ‘κ·Όμ„± ν™•μΈ

---

## π”„ **λ°°ν¬ μ•„ν‚¤ν…μ²**

### **CI/CD Pipeline**
```
Code β†’ Test β†’ Build β†’ Deploy β†’ Monitor
```

### **Environment Strategy**
- **Development**: λ΅μ»¬ κ°λ° ν™κ²½
- **Staging**: ν†µν•© ν…μ¤νΈ ν™κ²½
- **Production**: μ΄μ ν™κ²½

---

## π“ **μ„±λ¥ μ§€ν‘**

### **KPI (Key Performance Indicators)**
- **Response Time**: API μ‘λ‹µ μ‹κ°„ < 500ms
- **Throughput**: μ΄λ‹Ή μ”μ²­ μ²λ¦¬λ‰
- **Error Rate**: μ—λ¬μ¨ < 1%
- **Availability**: κ°€μ©μ„± > 99.9%

---

## π― **κ²°λ΅ **

Ultrathink Engineering μ² ν•™μ„ μ μ©ν• BeMore λ°±μ—”λ“λ”:

1. **ν™•μ¥ κ°€λ¥ν• κµ¬μ΅°**: DDD + Clean Architecture
2. **ν…μ¤νΈ μ©μ΄μ„±**: μΈν„°νμ΄μ¤ κΈ°λ° μμ΅΄μ„± λ¶„λ¦¬
3. **μ μ§€λ³΄μμ„±**: λ…ν™•ν• λ μ΄μ–΄ λ¶„λ¦¬
4. **μ„±λ¥ μµμ ν™”**: μΊμ‹±, λΉ„λ™κΈ° μ²λ¦¬ μ¤€λΉ„
5. **λ³΄μ• κ°•ν™”**: JWT, μ…λ ¥ κ²€μ¦, μ•”νΈν™”

μ΄ κµ¬μ΅°λ” ν„μ¬ μ”κµ¬μ‚¬ν•­μ„ μ¶©μ΅±ν•λ©΄μ„λ„ λ―Έλμ ν™•μ¥κ³Ό λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ „ν™μ„ κ³ λ ¤ν• μ‹¬μΈµμ  μ„¤κ³„μ…λ‹λ‹¤. 